<?php // -*-PHP-*-

require ('./common.inc.php');

$token = GET_ldapFilterSafe("token");
$maxRows = min(max(1, GET_or_NULL("maxRows")), 10);

$users = searchPeople(people_filters($token), false, $PEOPLE_ATTRS, "uid", $maxRows);
$groups = getGroupsFromGroupsDn(groups_filters($token), $maxRows);
$structures = getGroupsFromStructuresDn(structures_filters($token), $maxRows);
$structures = remove_businessCategory($structures);
$diploma = getGroupsFromDiplomaDn(diploma_filters($token), $maxRows);
$all_groups = array_merge($groups, $structures, $diploma);

$all_groups = exact_match_first($all_groups, $token);
add_group_category($all_groups);
remove_rawKey($all_groups);
remove_modifyTimestamp($all_groups);

echoJson(array("users" => $users, "groups" => $all_groups));

?>
